# 🤖 BTC交易机器人 - 15分钟谐波+斐波那契权重增强版

基于AI自主权的增强型加密货币交易机器人，集成了15分钟级别的谐波模式识别和斐波那契权重分析系统。

## 🎯 核心特性

### 🔍 15分钟谐波+斐波那契权重系统
- **谐波模式检测**: 支持Gartley、Bat、Butterfly、Crab等主要谐波形态
- **斐波那契水平分析**: 15分钟专属斐波那契支撑阻力计算
- **权重整合算法**: 多因素加权形成综合买入权重（基础权重、趋势对齐、价格接近度等）
- **动态优先级调整**: 根据权重值自动调整信号优先级（≥2.5→AI_ANALYSIS级别，≥2.0→SMC_STRUCTURE级别）

### 🤖 AI自主权增强
- **超低激活阈值**: 0.005%价格接近度触发分析
- **动态杠杆**: 高R:R比例时自动提升杠杆至40倍
- **AI温度优化**: 0.4温度设置获得更多创造性和容忍度
- **多源信号融合**: AI分析、SMC结构、动量信号权重分配

### 📊 多时间框架分析
- **主要时间框架**: 15分钟（结构确认）
- **确认时间框架**: 1小时（趋势验证）
- **高时间框架**: 4小时（偏差确认）
- **AI趋势一致性**: 多时间框架趋势对齐验证

### 🛡️ 智能风险管理
- **动态风险调整**: 基于R:R比例的风险参数优化
- **新鲜区域跟踪**: 限制关键区域交互次数（10次）
- **算法化止盈**: 结合斐波那契水平的智能止盈计算
- **实时风险监控**: 最大日亏损15%，最大回撤20%

## 📈 交易逻辑

### 信号生成流程
1. **价格激活**: 价格接近关键水平（0.005%阈值）
2. **谐波+斐波那契分析**: 检测谐波模式并计算斐波那契权重
3. **多源信号融合**: AI分析、SMC结构、动量信号权重整合
4. **风险回报比验证**: 最小2.0:1，激进模式3.0:1
5. **信号优先级排序**: 根据权重和质量进行信号排序
6. **交易执行**: 满足所有条件后执行交易

### 权重计算因子
- **基础权重**: 谐波模式有效性（1.0-2.0）
- **趋势对齐**: 多时间框架趋势一致性（0.5-1.5）
- **价格接近度**: 当前价格与关键水平距离（0.5-1.0）
- **成交量确认**: 相对移动平均的成交量比率（0.6x阈值）
- **谐波斐波那契协同**: 模式与斐波那契水平重叠度（0.0-1.0）

## ⚙️ 配置参数

### 核心交易参数
```python
symbol = 'BTC/USDC:USDC'
amount = 0.01  # 基础交易量
leverage = 40   # 最大杠杆倍数
risk_per_trade = 0.018  # 单笔交易风险1.8%
activation_threshold = 0.00005  # 0.005%激活阈值
```

### 谐波+斐波那契权重配置
```python
# 15分钟级别权重增强
level_weights = {
    '15m_harmonic_pattern': 2.5,      # 谐波模式权重
    '15m_fibonacci_level': 2.0,       # 斐波那契水平权重
    '15m_structure_break': 1.8,       # 结构突破权重
    '15m_fvg_bull_mid': 1.5,         # FVG多头权重
    '15m_fvg_bear_mid': 1.5,         # FVG空头权重
}

# 谐波斐波那契协同权重
harmonic_fibonacci_synergy_weight = 0.5  # 协同效应权重
```

### 风险管理参数
```python
max_daily_loss_pct = 0.15      # 最大日亏损15%
max_drawdown_pct = 0.20        # 最大回撤20%
max_open_positions = 6         # 最大持仓数
min_amount_usdc = 50           # 最小持仓金额
rr_min_threshold = 2.0         # 最小R:R比例
```

## 🚀 快速开始

### 环境要求
```bash
python >= 3.8
ccxt >= 4.0.0
pandas >= 1.5.0
numpy >= 1.21.0
requests >= 2.28.0
python-dotenv >= 0.19.0
```

### 安装依赖
```bash
pip install -r requirements.txt
```

### 配置环境变量
创建 `.env` 文件：
```
EXCHANGE_API_KEY=your_api_key
EXCHANGE_SECRET=your_secret
TELEGRAM_BOT_TOKEN=your_telegram_token
TELEGRAM_CHAT_ID=your_chat_id
DEEPSEEK_API_KEY=your_deepseek_key
```

### 启动交易机器人
```bash
python btc_trading_bot.py
```

## 📋 信号示例

### 高质量谐波+斐波那契信号
```json
{
    "signal": "BUY",
    "entry_price": 43250.00,
    "stop_loss": 43100.00,
    "take_profit": 43600.00,
    "confidence": "HIGH",
    "reason": "15分钟谐波+斐波那契高权重信号 (权重=2.85, 协同=0.75), Gartley模式在0.618斐波那契回撤位形成，多时间框架趋势一致"
}
```

### 权重计算示例
```
基础谐波权重: 1.8 (有效Gartley模式)
趋势对齐权重: 1.2 (15m/1h/4h趋势一致)
价格接近度: 0.9 (价格接近0.618斐波那契水平)
成交量确认: 1.1 (成交量超过MA的1.1倍)
谐波斐波那契协同: 0.65 (模式与斐波那契高度重叠)

总权重 = 1.8 + 1.2 + 0.9 + 1.1 + 0.65 = 5.65
标准化权重 = 2.83 (HIGH优先级)
```

## 📊 性能指标

### 预期性能提升
- **信号质量**: 提升30-40%
- **胜率预期**: 70-80% (vs 60-70%基础版)
- **风险回报比**: 平均2.5-3.0:1 (vs 2.0:1基础版)
- **日开单量**: 1-3单 (质量导向，vs 2-4单基础版)

### 关键优势
1. **谐波模式精确性**: 提供精确的反转区域识别
2. **斐波那契数学严谨性**: 基于黄金分割的关键水平
3. **多因子权重整合**: 避免单一指标的假信号
4. **动态优先级调整**: 根据市场条件智能调整信号重要性

## 🔧 监控与调试

### 日志系统
- **系统日志**: `btc_trading_bot.log`
- **心跳日志**: `heartbeat.log`
- **信号历史**: `btc_signal_history.json`

### 关键监控指标
```bash
# 查看实时信号生成
tail -f btc_trading_bot.log | grep "谐波+斐波那契"

# 监控权重计算
tail -f btc_trading_bot.log | grep "权重"

# 检查信号优先级
tail -f btc_trading_bot.log | grep "优先级"
```

## ⚠️ 风险提示

1. **市场风险**: 加密货币市场波动性极高，即使高质量信号也可能失败
2. **技术风险**: 谐波模式和斐波那契水平并非100%准确
3. **流动性风险**: 高杠杆交易存在爆仓风险
4. **系统风险**: 自动化交易系统存在技术故障可能性

## 📝 更新日志

### v2.0 - 15分钟谐波+斐波那契权重系统
- ✅ 新增谐波模式检测功能
- ✅ 集成15分钟斐波那契水平分析
- ✅ 实现多因子权重计算算法
- ✅ 优化信号优先级排序机制
- ✅ 增强风险管理参数

### v1.5 - AI自主权增强版
- ✅ 降低激活阈值至0.005%
- ✅ 提升AI信号权重至60%
- ✅ 动态杠杆优化
- ✅ 多时间框架趋势一致性验证

## 🏆 免责声明

本交易系统仅供教育和研究目的使用。加密货币交易涉及重大风险，可能导致资金损失。请根据自身风险承受能力谨慎使用，并考虑寻求专业财务建议。

## 📞 支持与联系

如有问题或建议，请通过以下方式联系：
- 邮箱: your-email@example.com
- Telegram: @your_telegram
- GitHub Issues: [提交问题](https://github.com/your-repo/issues)

---

**🎯 记住: 质量胜过数量，谐波+斐波那契权重系统让您的交易更精准！**